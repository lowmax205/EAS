# Story 1.6: Campus-Specific Reporting & Analytics

## Status
Draft

## Story
**As a** system administrator,
**I want** comprehensive multi-campus reporting and administrative controls,
**so that** I can manage multiple campuses effectively while maintaining data isolation and providing campus-specific analytics.

## Acceptance Criteria
1. Campus-specific dashboards show analytics isolated to each campus
2. Super admin dashboard provides cross-campus analytics and system-wide reporting
3. Campus management interface allows CRUD operations on campus entities
4. Campus admin role can manage users and events only within their assigned campus
5. Reporting exports maintain campus context and data isolation

## Integration Verification
- **IV1:** Existing SNSU analytics and reporting remain accurate and functional
- **IV2:** Campus-specific reports show correct data without cross-campus leakage
- **IV3:** Super admin controls work across all campuses without performance degradation
- **IV4:** Campus admin permissions are properly scoped and enforced

## Tasks / Subtasks
- [ ] Task 1: Campus-Specific Dashboard Analytics (AC: 1)
  - [ ] Create campus-filtered analytics components
  - [ ] Implement campus-aware data aggregation services
  - [ ] Update existing dashboard to show campus context
  - [ ] Add campus comparison charts for super admins
- [ ] Task 2: Super Admin Cross-Campus Dashboard (AC: 2)
  - [ ] Design super admin dashboard with campus overview
  - [ ] Implement cross-campus analytics and reporting
  - [ ] Add campus selection controls for super admin views
  - [ ] Create system-wide reporting capabilities
- [ ] Task 3: Campus Management Interface (AC: 3)
  - [ ] Create campus CRUD interface for super admins
  - [ ] Implement campus configuration management
  - [ ] Add campus activation/deactivation controls
  - [ ] Build campus settings and branding management
- [ ] Task 4: Campus Admin Permission System (AC: 4)
  - [ ] Implement campus-scoped admin permissions
  - [ ] Create campus admin user management interface
  - [ ] Add campus admin event management controls
  - [ ] Enforce campus boundaries in admin operations
- [ ] Task 5: Campus-Aware Reporting System (AC: 5)
  - [ ] Update report generation to include campus context
  - [ ] Implement campus-filtered data export functionality
  - [ ] Add campus comparison reporting capabilities
  - [ ] Ensure report data isolation and security

## Dev Notes

### Previous Story Context
**Story 1.1:** Campus data model and user assignment completed
**Story 1.2:** Campus-aware event and attendance management implemented

### Dashboard Architecture
**Current Dashboard Structure:** [Source: frontend-brownfield-architecture.md]
```typescript
// Existing dashboard components to enhance
src/features/dashboard/
├── components/
│   ├── DashboardCards.tsx      // Enhance with campus filtering
│   ├── AnalyticsCharts.tsx     // Add campus context
│   └── QuickActions.tsx        // Add campus management actions
├── hooks/
│   └── useDashboardData.ts     // Campus-aware data fetching
└── services/
    └── analyticsService.ts     // Campus analytics API
```

**Campus Dashboard Enhancement:** [Source: architecture/component-architecture.md]
```typescript
interface CampusDashboardData {
  campusId: number
  campusName: string
  metrics: {
    totalEvents: number
    totalUsers: number
    totalAttendance: number
    activeEvents: number
  }
  charts: {
    attendanceOverTime: ChartData[]
    eventsByDepartment: ChartData[]
    userActivityMetrics: ChartData[]
  }
}
```

### Admin Role Enhancement
**Campus Admin Permissions:** [Source: architecture/security-integration.md]
```typescript
interface CampusAdminPermissions {
  campusId: number
  permissions: {
    canManageUsers: boolean         // Within campus only
    canManageEvents: boolean        // Within campus only
    canViewReports: boolean         // Campus-specific only
    canExportData: boolean          // Campus data only
  }
}

interface SuperAdminPermissions {
  permissions: {
    canManageCampuses: boolean      // CRUD campus entities
    canViewAllCampuses: boolean     // Cross-campus analytics
    canManageSystemUsers: boolean   // Super admin user management
    canAccessSystemReports: boolean // System-wide reporting
  }
}
```

### Reporting System Enhancement
**Campus-Aware Report Generation:** [Source: architecture/api-design-and-integration.md]
```typescript
class ReportingService {
  async generateCampusReport(
    campusId: number, 
    reportType: ReportType, 
    dateRange: DateRange
  ): Promise<Report> {
    return this.apiClient.post('/reports/campus', {
      campus_id: campusId,
      report_type: reportType,
      date_range: dateRange
    })
  }
  
  async generateSystemReport(
    reportType: SystemReportType,
    campusIds?: number[]
  ): Promise<SystemReport> {
    // Super admin only
    return this.apiClient.post('/reports/system', {
      report_type: reportType,
      campus_ids: campusIds
    })
  }
}
```

### Analytics Data Structure
**Campus Analytics Models:** [Source: architecture/data-model-deep-dive.md]
```typescript
interface CampusAnalytics {
  campusId: number
  period: string
  metrics: {
    events: {
      total: number
      active: number
      completed: number
      cancelled: number
    }
    attendance: {
      total: number
      averagePerEvent: number
      attendanceRate: number
    }
    users: {
      total: number
      active: number
      newRegistrations: number
    }
  }
}
```

### Component Integration Points
**Dashboard Components:** [Source: frontend-brownfield-architecture.md]
- **CampusSelector:** Campus switching for super admins
- **CampusMetricsCard:** Campus-specific analytics display
- **CrossCampusComparison:** Multi-campus comparison charts
- **CampusManagementTable:** Campus CRUD interface

**Admin Components:**
- **CampusUserManagement:** Campus-scoped user administration
- **CampusEventManagement:** Campus-scoped event administration  
- **CampusSettingsForm:** Campus configuration interface
- **CampusReportGenerator:** Campus-specific report generation

### Technology Integration
**Frontend Stack:** [Source: architecture/tech-stack-alignment.md]
- **React Query:** Campus-aware data fetching and caching
- **ShadCN/UI Charts:** Campus analytics visualization
- **React Table:** Campus-filtered data tables
- **Export Libraries:** Campus-scoped data export

**Backend Stack:** [Source: architecture/tech-stack-alignment.md]
- **Django Admin:** Campus management interface
- **DRF Permissions:** Campus-scoped admin permissions
- **Celery Tasks:** Campus-specific report generation
- **Export Services:** Campus data export functionality

### Database Queries
**Campus Analytics Queries:** [Source: architecture/data-model-deep-dive.md]
```sql
-- Campus-specific event analytics
SELECT 
  COUNT(*) as total_events,
  COUNT(CASE WHEN status = 'active' THEN 1 END) as active_events
FROM events 
WHERE campus_id = ? AND date >= ? AND date <= ?;

-- Campus attendance metrics
SELECT 
  e.campus_id,
  COUNT(a.id) as total_attendance,
  AVG(event_attendance.count) as avg_per_event
FROM events e
LEFT JOIN attendance a ON e.id = a.event_id
WHERE e.campus_id = ?
GROUP BY e.campus_id;
```

### Security Implementation
**Admin Access Control:** [Source: architecture/security-integration.md]
- Campus admin access validated against user's campus assignment
- Super admin access requires explicit system-level permissions
- Report data filtered based on user's campus access scope
- Export functionality respects campus data boundaries

### Performance Considerations
**Analytics Optimization:** [Source: architecture/data-model-deep-dive.md]
- Campus analytics data cached with campus-specific cache keys
- Composite indexes for campus-based reporting queries
- Aggregated metrics pre-calculated for dashboard performance
- Campus comparison queries optimized with proper indexing

### File Locations
**Frontend Files:**
- `src/features/admin/components/CampusManagement.tsx`
- `src/features/dashboard/components/CampusDashboard.tsx`
- `src/features/reports/components/CampusReporting.tsx`
- `src/features/admin/hooks/useCampusAdmin.ts`

**Backend Files:**
- `backend/apps/analytics/models.py` - Campus analytics models
- `backend/apps/analytics/services.py` - Campus analytics services
- `backend/apps/reports/views.py` - Campus-aware reporting
- `backend/apps/admin/permissions.py` - Campus admin permissions

### Testing Requirements
**Campus Admin Testing:** [Source: architecture/testing-strategy.md]
```typescript
describe('Campus Admin Permissions', () => {
  it('prevents campus admin from accessing other campus data', () => {
    // Test campus boundary enforcement
  })
  
  it('allows super admin to access all campus data', () => {
    // Test super admin cross-campus access
  })
})
```

### Migration Dependencies
**Prerequisites:** Stories 1.1 and 1.2 must be completed
**New Database Tables:** Campus analytics aggregation tables
**Permission Updates:** User role system enhanced with campus admin role

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-30 | 1.0 | Multi-campus reporting and admin controls story | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be populated here after implementation*
